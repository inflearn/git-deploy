#!/bin/bash

# Welcom screen

echo "                                                               ";
echo "â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—";
echo "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘";
echo "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘";
echo "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘";
echo "â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘";
echo "â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•";
echo "                                                               ";
echo "Git deploy ìŠ¤í¬ë¦½íŠ¸";
echo ""

# Script to deploy to test branch

usage() {
    err_msg "ì‚¬ìš©ë²•: git-deploy [--dev]"
    exit 1
}

exit_on_failed() { 
    echo "$@";
    exit 1; 
}

err_msg() { echo "$@" ;} >&2

# long ì˜µì…˜ ì²˜ë¦¬
A=""
is_dev=0
while true; do
    [ $# -eq 0 ] && break
    case $1 in
        --dev)
            is_dev=1
            shift; continue
            ;;
        --*) 
            err_msg "ì•Œ ìˆ˜ ì—†ëŠ” ì˜µì…˜: $1"
            usage;
            ;;
    esac

    A=$A$([ -n "$A" ] && echo -e "\a")$1
    shift
done

# Delete 'test' branch with -f option

echo "ğŸ—‘ test ë¸Œëœì¹˜ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤"
echo "git branch -D test"
git branch -D test

echo ""

# Checkout current branch or 'dev' if --dev option has been given

git_current_branch=$(git branch --show-current)
if [ $is_dev -eq 1 ]
    then
        echo "ğŸ¦ dev ë¸Œëœì¹˜ë¡œ ì „í™˜í•©ë‹ˆë‹¤"
        echo "git checkout dev"
        git checkout dev || exit_on_failed "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
    else
        echo "ğŸ‡ğŸ¾ $git_current_branch ë¸Œëœì¹˜ë¡œ ì „í™˜í•©ë‹ˆë‹¤"
        echo "git checkout $git_current_branch"
        git checkout $git_current_branch || exit_on_failed "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
fi

echo ""

# Create new branch 'test' and checkout to this

echo "â™»ï¸  test ë¸Œëœì¹˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤"
echo "git checkout -b test"
git checkout -b test || exit_on_failed "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."

echo ""

# Set upstream branch to 'origin test'

echo "ğŸ½ï¸  test ë¸Œëœì¹˜ì˜ ì—…ìŠ¤íŠ¸ë¦¼ì„ origin/testë¡œ ì„¤ì •í•©ë‹ˆë‹¤"
echo "git branch --set-upstream-to=origin/test"
git branch --set-upstream-to=origin/test || exit_on_failed "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."

echo ""

# Push local 'test' branch onto the remote 'test' branch with -f option

echo "ğŸ›ŒğŸ» ë¡œì»¬ test ë¸Œëœì¹˜ë¥¼ ë¦¬ëª¨íŠ¸ë¡œ ê°•ì œ í‘¸ì‹œí•©ë‹ˆë‹¤"
echo "git push -f"
git push -f || exit_on_failed "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."

echo ""

# Checkout back to initial branch 

echo "ğŸ‘¨ğŸ½â€ğŸ¦² ì‹œì‘ ë¸Œëœì¹˜ë¡œ ëŒì•„ì˜µë‹ˆë‹¤"
echo "git checkout $git_current_branch"
git checkout $git_current_branch || exit_on_failed "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."

echo ""

# Delete 'test' branch

echo "ğŸ„ğŸ¿â€â™€ï¸ test ë¸Œëœì¹˜ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤"
echo "git branch -D test"
git branch -D test || exit_on_failed "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."

echo ""

# Bye!

echo "ğŸ‘¨ğŸ¼â€ğŸ’» ì•ˆë…•!"